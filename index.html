<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello World</title>
    <script src="https://unpkg.com/react@latest/dist/react.js"></script>
    <script src="https://unpkg.com/react-dom@latest/dist/react-dom.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">

      function counter(state, action) {
        if (typeof state === 'undefined') {
          return 0;
        }

        if (action.type === 'INCREMENT') {
          return state + 1;
        } else if (action.type === 'DECREMENT') {
          return state - 1;
        } else {
          return state;
        }
      }


      const createStore = (reducer) => {
        let state;
        let listeners = [];

        const getState = () => state;

        const dispatch = (action) => {
          state = reducer(state, action);
          listeners.forEach(listener => listener());
        };

        const subscribe = (listener) => {
          listeners.push(listener);
          return () => {
            listeners = listeners.filter(l => l !== listener);
          }
        };

        dispatch({}); // dummy dispatch

        return { getState, dispatch, subscribe};
      };

      const store = createStore(counter);

      const Counter = ({value}) => (
        <h1>{value}</h1>
      );

      const render = () => {
        ReactDOM.render(
          <Counter value={store.getState()}/>,
          document.getElementById('root')
        );
      };


      store.subscribe(render);

      render();

    </script>
  </body>
</html>
